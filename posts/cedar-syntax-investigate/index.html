<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Davel"><title>How `Cedar` implement this syntax without punctuation? ｜ 一言半辞</title><meta name=description content="A few days ago, I searched for a Unit Test framework for Objc&amp;amp;Swift. Occasionally, I found Cedar. I know that all UT frameworks are much the same, but Cedar&amp;rsquo;s syntax attracted me.
The sample code is like below.
"><meta name=keywords content="Hugo,theme,zozo"><link rel="shortcut icon" href=https://ooopscc.github.io/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://ooopscc.github.iocss/normalize.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://ooopscc.github.io/css/zozo.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css><link rel=stylesheet type=text/css media=screen href=https://ooopscc.github.io/css/highlight.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>Home</a></li><li><a href=/posts/>Archive</a></li><li><a href=/tags/>Tags</a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://ooopscc.github.io><span>一言半辞</span></a></h1></div><div class=description><p class=sub_title></p><div class=my_socials><a href=https://ooopscc.github.io/index.xml type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/cedar-syntax-investigate/>How `Cedar` implement this syntax without punctuation?</a></h2><span class=date>2022.04.17</span></div><div class="post_content markdown"><p>A few days ago, I searched for a Unit Test framework for Objc&Swift. Occasionally, I found <code>Cedar</code>. I know that all UT frameworks are much the same, but <code>Cedar</code>&rsquo;s syntax attracted me.</p><p>The sample code is like below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl><span class=n>describe</span><span class=p>(</span><span class=s>@&#34;Example specs on NSString&#34;</span><span class=p>,</span> <span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>it</span><span class=p>(</span><span class=s>@&#34;lowercaseString returns a new string with everything in lower case&#34;</span><span class=p>,</span> <span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=s>@&#34;FOOBar&#34;</span> <span class=n>lowercaseString</span><span class=p>]</span> <span class=n>should</span> <span class=n>equal</span><span class=p>(</span><span class=s>@&#34;foobar&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>it</span><span class=p>(</span><span class=s>@&#34;length returns the number of characters in the string&#34;</span><span class=p>,</span> <span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=s>@&#34;internationalization&#34;</span> <span class=n>length</span><span class=p>]</span> <span class=n>should</span> <span class=n>equal</span><span class=p>(</span><span class=mi>20</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>describe</span><span class=p>(</span><span class=s>@&#34;isEqualToString:&#34;</span><span class=p>,</span> <span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>it</span><span class=p>(</span><span class=s>@&#34;should return true if the strings are the same&#34;</span><span class=p>,</span> <span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s>@&#34;someString&#34;</span> <span class=nl>isEqualToString</span><span class=p>:</span><span class=s>@&#34;someString&#34;</span><span class=p>]</span> <span class=n>should</span> <span class=n>be_truthy</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>it</span><span class=p>(</span><span class=s>@&#34;should return false if the strings are not the same&#34;</span><span class=p>,</span> <span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s>@&#34;someString&#34;</span> <span class=nl>isEqualToString</span><span class=p>:</span><span class=s>@&#34;anotherString&#34;</span><span class=p>]</span> <span class=n>should</span> <span class=n>be_falsy</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>It is simple, importantly, there is no punctuation in assert syntax.
The most interesting part is <code>should</code> and <code>should_not</code>.</p><p>The lib is written in C++. Though I am not good at C++, a programmer&rsquo;s intuition and experience help me finally figure out how it implements this syntax.</p><p>The first thing that comes to my mind is <code>operation overload</code>. And after digging into the source code confirmed this.</p><p><code>should</code> is a macro, <code>Cedar</code> overloads the operation comma <code>,</code>.
let&rsquo;s see how <code>should</code> is defined.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl><span class=cp>#ifndef CEDAR_MATCHERS_DISALLOW_SHOULD
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#define should ,(ActualValueMarker){__FILE__, __LINE__},false,
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=cp>#define should_not ,(ActualValueMarker){__FILE__, __LINE__},true,
</span></span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span></code></pre></div><p>But there are so many commas in there to distinguish which is which.
Let&rsquo;s do it step by step. Use this official sample code as an example.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl><span class=cp>#import &lt;Cedar/Cedar.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>using</span> <span class=n>namespace</span> <span class=n>Cedar</span><span class=o>::</span><span class=n>Matchers</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>using</span> <span class=n>namespace</span> <span class=n>Cedar</span><span class=o>::</span><span class=n>Doubles</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>SPEC_BEGIN</span><span class=p>(</span><span class=n>iOSFrameworkSpecs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>describe</span><span class=p>(</span><span class=s>@&#34;Cedar-iOS&#34;</span><span class=p>,</span> <span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>__block</span> <span class=n>NSObject</span> <span class=o>*</span><span class=n>object</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>beforeEach</span><span class=p>(</span><span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>object</span> <span class=o>=</span> <span class=p>[[</span><span class=n>NSObject</span> <span class=n>alloc</span><span class=p>]</span> <span class=n>init</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>it</span><span class=p>(</span><span class=s>@&#34;should allow assertions&#34;</span><span class=p>,</span> <span class=o>^</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>object</span> <span class=n>should_not</span> <span class=n>be_nil</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>object</span> <span class=n>should_not</span> <span class=nf>be_same_instance_as</span><span class=p>([[</span><span class=n>NSObject</span> <span class=n>alloc</span><span class=p>]</span> <span class=n>init</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>SPEC_END</span>
</span></span></code></pre></div><p>Notice the line</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl>        <span class=n>object</span> <span class=n>should_not</span> <span class=n>be_nil</span><span class=p>;</span> <span class=c1>// expr 1
</span></span></span></code></pre></div><p>If we look up the definition of <code>should_not</code>, the sentence can be converted to</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl>        <span class=n>object</span> <span class=p>,(</span><span class=n>ActualValueMarker</span><span class=p>){</span><span class=n>__FILE__</span><span class=p>,</span> <span class=n>__LINE__</span><span class=p>},</span><span class=nb>true</span><span class=p>,</span> <span class=n>be_nil</span><span class=p>;</span> <span class=c1>// expr 2
</span></span></span></code></pre></div><p>It can be confused at the first glimpse. We must split it into several parts.
Start from the easy part <code>(ActualValueMarker){__FILE__, __LINE__}</code>. <code>ActualValueMarker</code> is a struct. Assume that the comma in <code>{}</code> is just a comma (not operator overload).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>ActualValueMarker</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>fileName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>lineNumber</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span></code></pre></div><p>So the line above initialize a struct using the current <strong>file</strong> and <strong>line</strong> info. And other parts are <code>object</code>, <code>true</code> and <code>be_nil</code>.</p><p>We can infer that the first comma must be overloaded such that the syntax is C++ compatible.
Three comma operator overloading functions are right below the struct definition.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl>	<span class=c1>// overload 1
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>ActualValue</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=k>operator</span><span class=p>,(</span><span class=k>const</span> <span class=n>T</span> <span class=o>&amp;</span> <span class=n>actualValue</span><span class=p>,</span> <span class=k>const</span> <span class=n>ActualValueMarker</span> <span class=o>&amp;</span> <span class=n>marker</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ActualValue</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>marker</span><span class=p>.</span><span class=n>fileName</span><span class=p>,</span> <span class=n>marker</span><span class=p>.</span><span class=n>lineNumber</span><span class=p>,</span> <span class=n>actualValue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// overload 2
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>ActualValueMatchProxy</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=k>operator</span><span class=p>,(</span><span class=k>const</span> <span class=n>ActualValue</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>&amp;</span> <span class=n>actualValue</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>negate</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>negate</span> <span class=o>?</span> <span class=n>actualValue</span><span class=p>.</span><span class=nl>to_not</span> <span class=p>:</span> <span class=n>actualValue</span><span class=p>.</span><span class=n>to</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// overload 3
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=k>typename</span> <span class=n>MatcherType</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=k>operator</span><span class=p>,(</span><span class=k>const</span> <span class=n>ActualValueMatchProxy</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>&amp;</span> <span class=n>matchProxy</span><span class=p>,</span> <span class=k>const</span> <span class=n>MatcherType</span> <span class=o>&amp;</span> <span class=n>matcher</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>matchProxy</span><span class=p>(</span><span class=n>matcher</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>According to the function signature and real parameters, the first function is a match. <code>T</code> can be any type, the second parameter is the type of <code>ActualValueMarker</code>. So <code>expr 2</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl>        <span class=n>object</span> <span class=p>,(</span><span class=n>ActualValueMarker</span><span class=p>){</span><span class=n>__FILE__</span><span class=p>,</span> <span class=n>__LINE__</span><span class=p>},</span><span class=nb>true</span><span class=p>,</span> <span class=n>be_nil</span><span class=p>;</span>
</span></span></code></pre></div><p>will be</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl>        <span class=n>ActualValue</span><span class=o>&lt;</span><span class=n>NSObject</span><span class=o>&gt;</span><span class=p>(</span><span class=n>__FILE__</span><span class=p>,</span> <span class=n>__LINE__</span><span class=p>,</span> <span class=n>object</span><span class=p>),</span><span class=nb>true</span><span class=p>,</span> <span class=n>be_nil</span><span class=p>;</span> <span class=c1>// expr 3
</span></span></span></code></pre></div><p>And, obviously, that second comma of <code>expr 2</code> is also an overloading operator, cause it matches the second function&rsquo;s signature.
The <code>expr 3</code> can be changed to the form of</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl>        <span class=p>(</span><span class=n>ActualValue</span><span class=o>&lt;</span><span class=n>NSObject</span><span class=o>&gt;</span><span class=p>(</span><span class=n>__FILE__</span><span class=p>,</span> <span class=n>__LINE__</span><span class=p>,</span> <span class=n>object</span><span class=p>)).</span><span class=n>to_not</span><span class=p>,</span> <span class=n>be_nil</span><span class=p>;</span> <span class=c1>// expr 4
</span></span></span></code></pre></div><p><code>be_nil</code> is of type <code>BeNil</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>Cedar</span> <span class=p>{</span> <span class=k>namespace</span> <span class=n>Matchers</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>using</span> <span class=n>CedarBeNil</span> <span class=o>=</span> <span class=n>Cedar</span><span class=o>::</span><span class=n>Matchers</span><span class=o>::</span><span class=n>Private</span><span class=o>::</span><span class=n>BeNil</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>static</span> <span class=k>const</span> <span class=n>CedarBeNil</span> <span class=n>be_nil</span> <span class=o>=</span> <span class=n>CedarBeNil</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}}</span>
</span></span></code></pre></div><p>Let&rsquo;s dig into the <code>overload 3</code> function signature.
<code>to_not</code> if of type <code>ActualValueMatchProxy&lt;T> to_not;</code>, matches the first parameter&rsquo;s type. The <code>MatcherType</code> is a generic type of any type.
<code>expr 4</code> can be</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl>        <span class=p>(</span><span class=n>ActualValue</span><span class=o>&lt;</span><span class=n>NSObject</span><span class=o>&gt;</span><span class=p>(</span><span class=n>__FILE__</span><span class=p>,</span> <span class=n>__LINE__</span><span class=p>,</span> <span class=n>object</span><span class=p>)).</span><span class=n>to_not</span><span class=p>(</span><span class=n>be_nil</span><span class=p>);</span> <span class=c1>// expr 5
</span></span></span></code></pre></div><p>When I search <code>to_not</code>, I found it&rsquo;s not a function at all, but it can be called like it is.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl>		<span class=n>ActualValueMatchProxy</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>to_not</span><span class=p>;</span>
</span></span></code></pre></div><p>Actually, the magic part is <code>()</code> operator overload.
In <code>ActualValueMatchProxy</code> class public functions, there is an operator overload.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl>    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>MatcherType</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>ActualValueMatchProxy</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=k>operator</span><span class=p>()(</span><span class=k>const</span> <span class=n>MatcherType</span> <span class=o>&amp;</span> <span class=n>matcher</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>negate_</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>actualValue_</span><span class=p>.</span><span class=n>execute_negative_match</span><span class=p>(</span><span class=n>matcher</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>actualValue_</span><span class=p>.</span><span class=n>execute_positive_match</span><span class=p>(</span><span class=n>matcher</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>So <code>expr 5</code> -> <code>expr6</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl>        <span class=p>(</span><span class=n>ActualValue</span><span class=o>&lt;</span><span class=n>NSObject</span><span class=o>&gt;</span><span class=p>(</span><span class=n>__FILE__</span><span class=p>,</span> <span class=n>__LINE__</span><span class=p>,</span> <span class=n>object</span><span class=p>)).</span><span class=n>execute_negative_match</span><span class=p>(</span><span class=n>be_nil</span><span class=p>);</span> <span class=c1>// expr 6
</span></span></span></code></pre></div><p><code>execute_negative_match</code> implementation is like</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-objc data-lang=objc><span class=line><span class=cl>    <span class=n>template</span><span class=o>&lt;</span><span class=kr>typename</span> <span class=n>T</span><span class=o>&gt;</span> <span class=n>template</span><span class=o>&lt;</span><span class=kr>typename</span> <span class=n>MatcherType</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>ActualValue</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>execute_negative_match</span><span class=p>(</span><span class=k>const</span> <span class=n>MatcherType</span> <span class=o>&amp;</span> <span class=n>matcher</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>matcher</span><span class=p>.</span><span class=n>matches</span><span class=p>(</span><span class=n>value_</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>CDR_fail</span><span class=p>(</span><span class=n>fileName_</span><span class=p>.</span><span class=n>c_str</span><span class=p>(),</span> <span class=n>lineNumber_</span><span class=p>,</span> <span class=n>matcher</span><span class=p>.</span><span class=n>negative_failure_message_for</span><span class=p>(</span><span class=n>value_</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>The key point is <code>matcher.matches()</code> function. (<code>value_</code> is <code>object</code>). It is, in fact, <code>be_nil.matches()</code> function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl>    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>U</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=n>BeNil</span><span class=o>::</span><span class=n>matches</span><span class=p>(</span><span class=k>const</span> <span class=n>U</span> <span class=o>&amp;</span> <span class=n>actualValue</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ARC bug: http://lists.apple.com/archives/objc-language/2012/Feb/msg00078.html
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// Also blocks aren&#39;t considered a pointer type under both ARC and MRC
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>strcmp</span><span class=p>(</span><span class=err>@</span><span class=n>encode</span><span class=p>(</span><span class=n>U</span><span class=p>),</span> <span class=err>@</span><span class=n>encode</span><span class=p>(</span><span class=n>id</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>strcmp</span><span class=p>(</span><span class=err>@</span><span class=n>encode</span><span class=p>(</span><span class=n>U</span><span class=p>),</span> <span class=err>@</span><span class=n>encode</span><span class=p>(</span><span class=kt>void</span><span class=p>(</span><span class=o>^</span><span class=p>)(</span><span class=kt>void</span><span class=p>)))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>void</span> <span class=o>*</span><span class=n>ptrOfPtr</span> <span class=o>=</span> <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>actualValue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kt>void</span> <span class=o>*</span><span class=n>ptr</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=kt>void</span> <span class=o>**&gt;</span><span class=p>(</span><span class=n>ptrOfPtr</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>!</span><span class=n>ptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>[[</span><span class=n>CDRSpecFailure</span> <span class=nl>specFailureWithReason</span><span class=p>:</span><span class=err>@</span><span class=s>&#34;Attempt to compare non-pointer type to nil&#34;</span><span class=p>]</span> <span class=n>raise</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>NO</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>Until now, the <code>magic</code> is clear totally. It is just a pointer of pointer compares nil.</p><h1 id=conclusion>Conclusion</h1><p>After digging into the source code and trying to understand the C++ code operator overload feature, I finally find out how the library implements the without-punctuation syntax.
Though the syntax is a little fancy, the complexation and extra cost of understanding it introduced are not worth it. From the point of perfect, <code>should_not</code> should be <code>should not</code>, <code>be_falsy</code> should be <code>be falsy</code>. Then we will define a new trampoline class to handle this which will make it harder to maintain and fit all the bad cases.
Operator overload is a wonderful feature but should be used in the proper situation.</p></div><div class=post_footer></div></div><div class=doc_comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//davelliu.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span></span></div></footer><script src=https://ooopscc.github.io/js/jquery-3.5.1.min.js></script>
<link href=https://ooopscc.github.io/css/fancybox.min.css rel=stylesheet><script src=https://ooopscc.github.io/js/fancybox.min.js></script>
<script src=https://ooopscc.github.io/js/zozo.js></script>
<script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style></body></html>